!function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=1)}([function(e,t){e.exports=require("ajv")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(2),o=r(3),s=r(0),i=r(4),c=r(5),a=r(7),u=o.join(__dirname,"data","config.json");n.existsSync(u)||(console.log("Please set the config.json project configuration!"),process.exit(1));const l=JSON.parse(n.readFileSync(u,{encoding:"utf8"})),p=new s;p.validate({type:"object",required:["amqp","elastic","rule"],properties:{amqp:{type:"object",required:["hostname"],properties:{protocol:{enum:["amqp","amqps"]},hostname:{type:"string"},port:{type:"number"},username:{type:"string"},password:{type:"string"},locale:{type:"string"},frameMax:{type:"number"},heartbeat:{type:"number"},vhost:{type:"string"}}},elastic:{type:"object",properties:{node:{type:["string","array","object"]},nodes:{type:["string","array"]}}},rule:{type:"object"}}},l)||(console.log(p.errors),process.exit(1)),c.AmqpService.registered(l.amqp).then(e=>{i.subscribe(e,a.ElasticService.create(l.elastic).getClient(),l.rule)}).catch(e=>{e&&(console.log(e),process.exit(1))})},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("path")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0);t.subscribe=function(e,t,r){e.assertExchange("elastic.stash.exchange","direct",{durable:!0}),e.assertQueue("elastic.stash.basic",{durable:!0}),e.bindQueue("elastic.stash.basic","elastic.stash.exchange","/"),e.consume("elastic.stash.basic",async o=>{try{const s=new n;if(!s.validate({type:"string",contentMediaType:"application/json"},o.content.toString()))return console.log(s.errors),void e.ack(o);const i=JSON.parse(o.content.toString());if(!s.validate({type:"object",required:["index","body"],properties:{index:{type:"string"},body:{type:"object"}}},i))return console.log(s.errors),void e.ack(o);if(!r.hasOwnProperty(i.index))return console.log("The index json schema does not exist!"),void e.ack(o);if(!s.validate(r[i.index],i.body))return console.log(s.errors),void e.ack(o);201===(await t.index(i)).statusCode&&(console.log("stash success"),e.ack(o))}catch(t){console.log(t.message),e.ack(o)}},{noAck:!1},e=>{console.log(e)})}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(6);class o{constructor(e){this.options={},this.options=e}static registered(e){return new o(e).ready()}ready(){return new Promise((e,t)=>{n.connect(this.options,(r,n)=>{r&&t(r),n.createChannel((r,n)=>{r?t(r):(console.debug("SERVICE::SUBSCRIBE_START"),e(n))})})})}}t.AmqpService=o},function(e,t){e.exports=require("amqplib/callback_api")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(8);class o{constructor(e){this.client=new n.Client(e)}static create(e){return new o(e)}getClient(){return this.client}}t.ElasticService=o},function(e,t){e.exports=require("@elastic/elasticsearch")}]);